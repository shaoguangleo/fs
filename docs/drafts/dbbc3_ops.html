<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Version 1.3 - September 2021">
<title>DRAFT FS DBBC3 Operations Manual</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book">
<div id="header">
<h1>DRAFT FS DBBC3 Operations Manual</h1>
<div class="details">
<span id="author" class="author">Version 1.3 - September 2021</span><br>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_dbbc3_operations">2. DBBC3 operations</a>
<ul class="sectlevel2">
<li><a href="#_dbbc3_commands">2.1. DBBC3 commands</a></li>
<li><a href="#_fs_dbbc3_channel_and_if_labels">2.2. FS DBBC3 channel and IF labels</a></li>
<li><a href="#_initial_configuration_of_the_dbbc3">2.3. Initial configuration of the DBBC3</a></li>
<li><a href="#_local_configuration_changes">2.4. Local configuration changes</a></li>
<li><a href="#_experiment_mode_configuration">2.5. Experiment mode configuration</a></li>
<li><a href="#_control_files">2.6. Control files</a></li>
<li><a href="#_tsys_monitor_display">2.7. Tsys monitor display</a></li>
<li><a href="#_checking_dbbc3_time">2.8. Checking DBBC3 time</a></li>
<li><a href="#_setting_fs_time">2.9. Setting FS time</a></li>
<li><a href="#_multicast_logging">2.10. Multicast logging</a></li>
</ul>
</li>
<li><a href="#_related_features">3. Related Features</a>
<ul class="sectlevel2">
<li><a href="#_minimizing_the_use_of_setup_procedures">3.1. Minimizing the use of setup procedures</a></li>
<li><a href="#_thread_procedure">3.2. Thread procedure</a></li>
<li><a href="#_jive5ab_cnfg_procedure">3.3. jive5ab_cnfg procedure</a></li>
<li><a href="#_drudg_support">3.4. drudg support</a></li>
</ul>
</li>
<li><a href="#_handling_other_vdif_frame_payload_sizes">Appendix A: Handling other VDIF frame payload sizes</a>
<ul class="sectlevel2">
<li><a href="#_determine_the_other_settings">A.1. Determine the other settings</a></li>
<li><a href="#_update_the_snap_procedures">A.2. Update the SNAP procedures</a></li>
<li><a href="#_command_the_devices">A.3. Command the devices</a></li>
</ul>
</li>
<li><a href="#_installation_for_testing">Appendix B: Installation for testing</a>
<ul class="sectlevel2">
<li><a href="#_initial_installation_of_the_test_version">B.1. Initial installation of the test version</a></li>
<li><a href="#_switching_back_to_10_0_0">B.2. Switching back to 10.0.0</a></li>
<li><a href="#_switching_back_to_the_test_version">B.3. Switching back to the test version</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document outlines the model for FS operations with the DBBC3. It also
contains an appendix <a href="#_installation_for_testing">Installation for testing</a>. The latter provides some
pointers for installing and will eventually be superseded by the FS updates
notes for the first release that includes the DBBC3 support described in the
rest of this document.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_dbbc3_operations">2. DBBC3 operations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_dbbc3_commands">2.1. DBBC3 commands</h3>
<div class="paragraph">
<p>The following SNAP commands support DBBC3s. You can access help information
with <code>help=<em>command</em></code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bbc<em>nnn</em></code>&#8201;&#8212;&#8201;<code><em>nnn</em></code> from <code>001</code> to <code>128</code>&#8201;&#8212;&#8201;BBC setup and monitoring</p>
</li>
<li>
<p><code>bbc_gain</code>&#8201;&#8212;&#8201;Setup and monitor BBC gains</p>
</li>
<li>
<p><code>cont_cal</code>&#8201;&#8212;&#8201;Setup and monitor continuous calibration configuration</p>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
So far, operation has only been tested with polarity <code>2</code>. It is
expected that other polarities will work. However, until it is tested it won&#8217;t
be confirmed. This affects multicast data, the Tsys display, and use of <em>fivpt</em>
and <em>onoff</em>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>core3h_mode<em>n</em></code>&#8201;&#8212;&#8201;<code><em>n</em></code> from <code>0</code> to <code>8</code>&#8201;&#8212;&#8201;Core3H board setup and monitoring</p>
</li>
<li>
<p><code>fb_mode</code>&#8201;&#8212;&#8201;Setting the FlexBuff (<em>jive5ab</em>) recording mode&#8201;&#8212;&#8201;An alias for <code>mk5c_mode</code></p>
</li>
<li>
<p><code>fivept</code>&#8201;&#8212;&#8201;Pointing measurements</p>
</li>
<li>
<p><code>if<em>x</em></code>&#8201;&#8212;&#8201;<code><em>x</em></code> from <code>a</code> to <code>h</code>&#8201;&#8212;&#8201;IF CoMo setup and monitoring</p>
</li>
<li>
<p><code>iftp<em>x</em></code>&#8201;&#8212;&#8201;<code><em>x</em></code> from <code>a</code> to <code>h</code>&#8201;&#8212;&#8201;IF CoMo total power monitoring</p>
</li>
<li>
<p><code>mcast_time</code>&#8201;&#8212;&#8201;display of multicast time</p>
</li>
<li>
<p><code>onoff</code>&#8201;&#8212;&#8201;SEFD and antenna calibration measurements</p>
</li>
<li>
<p><code>tpicd</code>&#8201;&#8212;&#8201;TPI (multicast) recording control daemon setup</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_fs_dbbc3_channel_and_if_labels">2.2. FS DBBC3 channel and IF labels</h3>
<div class="paragraph">
<p>The DBBC3 channel labels are of the form <code><em>nnns</em></code>, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><em>nnn</em></code> is the channel number, <code>000</code>-<code>128</code></p>
</li>
<li>
<p><code><em>s</em></code> is the side-band, <code>l</code> or <code>u</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, <code>032u</code>.</p>
</div>
<div class="paragraph">
<p>The DBBC3 IF labels are of the form <code>i<em>x</em></code>, where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><em>x</em></code> is the IF, <code>a</code>-<code>h</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, <code>id</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_initial_configuration_of_the_dbbc3">2.3. Initial configuration of the DBBC3</h3>
<div class="paragraph">
<p>When the DBBC3 is booted, it is assumed it is set-up according to
the &#8220;Setting up the DBBC3 for DDC_U mode&#8221; document.</p>
</div>
</div>
<div class="sect2">
<h3 id="_local_configuration_changes">2.4. Local configuration changes</h3>
<div class="paragraph">
<p>This section covers changes that may be needed for experiments but aren&#8217;t
conveyed by the schedule file, yet. Some examples are given below.</p>
</div>
<div class="sect3">
<h4 id="_ethernet_configuration">2.4.1. Ethernet configuration</h4>
<div class="paragraph">
<p>The Ethernet configuration of a Core3H board can be set in the DBBC3 boot
configuration file. It can be changed on demand with a predefined SNAP
procedure with contents such as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dbbc3=core3h=1,tengbcfg eth0 ip=192.168.1.16 gateway=192.168.1.1 nm=27
dbbc3=core3h=1,tengbcfg eth1 ip=192.168.1.17 gateway=192.168.1.1 nm=27
dbbc3=core3h=1,tengbarp eth0 2 00:60:dd:44:47:60
dbbc3=core3h=1,tengbarp eth1 3 00:60:dd:44:47:61
dbbc3=core3h=1,destination 0 192.168.1.2:46220
dbbc3=core3h=1,destination 1 192.168.1.3:46221</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The above example is for one board. Multiple boards can combined in one
procedure or one procedure can call a separate sub-procedure for each board.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A reset and sync is not required for Ethernet configuration changes.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Questions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Is anything else needed for the Ethernet configuration?</p>
<div class="paragraph">
<p>Sven: no</p>
</div>
</li>
<li>
<p>Are there other things that would be useful to set from the FS? The mode is
covered below.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_changing_thread_numbers">2.4.2. Changing thread numbers</h4>
<div class="paragraph">
<p>The following command changes the thread number on <em>eth0</em> to <code>3</code>
(<code>196608/65536</code>) and <em>eth1</em> to <code>4</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dbbc3=core3h=1,regupdate vdif_header 3 196608 0x03FF0000</pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Questions:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Does this also change the thread number for <em>eth1</em> to <code>4</code>.</p>
<div class="paragraph">
<p>Sven: Yes.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_experiment_mode_configuration">2.5. Experiment mode configuration</h3>
<div class="paragraph">
<p>This section covers configuration parameters that are defined per schedule.</p>
</div>
<div class="paragraph">
<p>Due to certain changes in Core3H setup requiring a time sync afterwards, only
one mode can be used per schedule. The issue is that there is reluctance to
perform the time sync without operator supervision to verify it and possibly
re-sync it manually to correct problems.</p>
</div>
<div class="paragraph">
<p>As a result, during the schedule, only the configuration of the Core3H boards
are checked. A mechanism is provided to force the setting of the mode
configuration. This can be used before the experiment starts to place the
Core3H boards in the correct configuration without having to decode the
schedule configuration and set the Core3H boards up manually.</p>
</div>
<div class="sect3">
<h4 id="_configuring_core3h_boards">2.5.1. Configuring Core3H boards</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>At the current time, due to the issues discussed in the
<a href="#_time_sync">Time sync</a>
sub-section below, it is not possible to use this method for configuring the
Core3H boards. They must be configured from the boot configuration file.</p>
</div>
<div class="paragraph">
<p>The method described in the <a href="#_checking_the_mode">Checking the mode</a> sub-section below can, and
should, still be used to verify that the configuration agrees with the schedule.</p>
</div>
<div class="paragraph">
<p>Once the new DBBC3 time sync feature becomes available, it should be possible
to use the configuration method described here, without requiring a FS update.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the Core3H boards for the schedule mode:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>drudg</em> the schedule to make the <em>.prc</em> (and <em>.snp</em>) file</p>
</li>
<li>
<p>Start the FS</p>
</li>
<li>
<p>Open the experiment procedure library, e.g.:</p>
<div class="literalblock">
<div class="content">
<pre>proc=r4849kk</pre>
</div>
</div>
</li>
<li>
<p>Execute the normal <code>setup<em>mode</em></code> procedure, perhaps <code>setup01</code>, with the
<code>force</code> parameter, e.g.:</p>
<div class="literalblock">
<div class="content">
<pre>setup01=force</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>With or without the <code>force</code> the setup procedure configures all other aspects of
the mode besides the Core3H boards. That should be beneficial. If you only want
to configure the Core3H configuration, you can use the corresponding Core3H
configuration procedure instead. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>core3h01=force</pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
This is not recommended since there will be no checks that the rest of
the DBBC3 configures without errors. However, if the schedule is started
normally, the rest of the DBBC3 will be configured by the first setup procedure
encountered in the schedule.
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The FS hard codes a VDIF frame payload size of <code>8000</code>. If a different
size is needed, please see the <a href="#_handling_other_vdif_frame_payload_sizes">Handling other VDIF frame payload sizes</a>
appendix.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_the_details">The details</h5>
<div class="paragraph">
<p>For each Core3H that is in use, the following information will be set, in
this order:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Decimation</p>
</li>
<li>
<p>Splitmode</p>
</li>
<li>
<p>Bitmask</p>
</li>
<li>
<p><code>reset</code></p>
</li>
<li>
<p><code>vdif_frame &#8230;&#8203;</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>core3h=1,vsi_samplerate 128000000 2
core3h=1,splitmode on
core3h=1,vsi_bitmask 0xcccccccc
core3h=1,reset
core3h=1,vdif_frame 2 8 8000 ct=off</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The FS makes some simplifying assumptions when forming the <code>vdif_frame</code>
command. These are believed to agree with limitations in the DBBC3 and what is
needed for practical operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For the number of bits per channel:</p>
<div class="paragraph">
<p>If any channel on a board uses two bits, it is assumed that all do.</p>
</div>
</li>
<li>
<p>For the number of channels:</p>
<div class="paragraph">
<p>The BBCs for each board are handled as two groups: the first eight and up to an
additional eight. This splits the BBCs in agreement with the Ethernet ports
where their channels are destined. The number of channels in the group with
largest number of channels is rounded up to the next power of two, if it is not
a power of two already. The resulting, possibly rounded value, is used as the
number of channels.</p>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_time_sync">2.5.2. Time sync</h4>
<div class="paragraph">
<p>After the Core3H boards are configured, the operator needs to sync each Core3H
and sync the PPS. In principle, this would consist of:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dbbc3=core3h=1,timesync
dbbc3=core3h=2,timesync
dbbc3=core3h=3,timesync
dbbc3=core3h=4,timesync
dbbc3=core3h=5,timesync
dbbc3=core3h=6,timesync
dbbc3=core3h=7,timesync
dbbc3=core3h=8,timesync
dbbc3=pps_sync</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It may take the time on the boards a few tens of seconds to stabilize
after the commands.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>All the Core3H boards in the system need to synced, then a <code>pps_sync</code> must be
issued within 20 seconds of the first <code>timesync</code>. This is not currently
possible since each <code>timesync</code> requires about six seconds. A new DBBC3 feature
is being developed to allow syncing the boards in parallel and issue a timely
<code>pps_sync</code>. Until then, the only safe way to configure a DBBC3 is with the boot
configuration. However, the above procedure may work, but please verify that
afterwards all boards have the correct time, VDIF epoch (see <strong>NOTE</strong> below), a
<code>pps_delay</code> is no more than a few tens of nanoseconds.</p>
</div>
<div class="paragraph">
<p>A <em>drudg</em> setup procedure without the <code>force</code> parameter, can still be used to
verify the configuration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The sync was successful if there no errors reported and all the boards have the
same time and VDIF epoch.</p>
</div>
<div class="paragraph">
<p>The best way to check the time for version <em>v125</em> and later is with the
<code>mcast_time</code> command. For earlier versions the <code>dbbc3=time</code> command can be
used, but the output can be difficult to interpret because the boards may
sampled in different seconds.</p>
</div>
<div class="paragraph">
<p>The VDIF epoch and the time can be checked per board with
<code>dbbc3=core3h=<em>board</em>,time</code>, where <code><em>board</em></code> is the board number.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Questions:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Is this sufficient?</p>
<div class="paragraph">
<p>Sven: No, the <code>pps_sync</code> was missing (but it requires a new command to implement properly).</p>
</div>
</li>
<li>
<p>Since there is concern that this may not work correctly, how does one tell if
it was successful?</p>
<div class="paragraph">
<p>Sven: The sync was successful if there no errors reported and all the boards
have the same time and VDIF epoch.</p>
</div>
</li>
<li>
<p>Can we then skip <code>start vdif</code> before the <code>timesync</code>?</p>
<div class="paragraph">
<p>Sven: Yes. Actually, the <code>start vdif</code> won&#8217;t work until the board has been
synced.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_starting_data_transmission">2.5.3. Starting data transmission</h4>
<div class="paragraph">
<p>After the boards are synced, data transmission needs to started or stopped for
each board, as appropriate for the mode. Assuming the setup procedure for the
mode has been previously been with the <code>force</code> parameter as described in the
<a href="#_configuring_core3h_boards">Configuring Core3H boards</a> sub-section above, this can be accomplished with
the command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>core3h_mode0=end,force</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>After the boards have been synced, data transmission can be freely started and
stopped on individual boards as needed. For example to start transmission on
board <code>1</code>, you can use:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dbbc3=core3h=1,start vdif</pre>
</div>
</div>
<div class="paragraph">
<p>To stop transmission, use:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>dbbc3=core3h=1,stop</pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Using these commands may make whether the board is transmitting data
inconsistent with the FS configuration and may lead to problems.
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_checking_the_mode">2.5.4. Checking the mode</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
It is essential to check the mode as described after it has been
configured by either the DBBC3 boot configuration or manually as described in
the <a href="#_configuring_core3h_boards">Configuring Core3H boards</a> sub-section above before the experiment, and
verify that <em>no</em> errors are reported. If there are errors the data may not be
recorded properly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After the data transmission has been started, the setup procedure can be
re-executed without the <code>force</code> to parameter to check that the setup is
correct. Assuming the schedule procedure library has already been opened as
described in the <a href="#_configuring_core3h_boards">Configuring Core3H boards</a> sub-section above, then for
example use:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>setup01</pre>
</div>
</div>
<div class="paragraph">
<p>Any deviations will be reported as errors. This is how the setup is checked
within a schedule. This also checks that the personality and firmware version
agree with the FS control files.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Using the setup procedure to check the mode will also command all the
non-Core3H setup for the mode, which should be benign. If you really only want
to check the Core3H configuration, you can use the corresponding Core3H
configuration procedure instead. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>core3h01</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_control_files">2.6. Control files</h3>
<div class="sect3">
<h4 id="_equip_ctl">2.6.1. equip.ctl</h4>
<div class="paragraph">
<p>For DBBC3 use, the rack type in <em>equip.ctl</em> should be <code>dbbc3_ddc_u</code> or
<code>dbbc3_ddc_v</code> depending on the firmware that is loaded.</p>
</div>
<div class="paragraph">
<p>The clock rate should be set to <code>nominal</code>, which gives the 128 MHz fixed value.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Questions:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Should we support <em>DDC_V</em>?</p>
<div class="paragraph">
<p>It may not be necessary since <em>DDC_U</em> is more general.</p>
</div>
</li>
<li>
<p>If we are supporting <em>DDC_V</em>, are there any differences besides:</p>
<div class="ulist">
<ul>
<li>
<p>Sending only one mask per board instead of four</p>
</li>
<li>
<p>Only having 32 MHz BW, decimation 2</p>
</li>
<li>
<p>Is splitmode always on?</p>
<div class="paragraph">
<p>Sven: For <em>DDC_V</em>, it is always off; <em>DDC_U</em>, always on.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dbbc3_ctl">2.6.2. dbbc3.ctl</h4>
<div class="paragraph">
<p>The DBBC3 specific control file parameters are in the <em>dbbc3.ctl</em> control file.
An example of the contents are:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>* bbcs/if (8, 12, or 16), ifs (1-8)
  8 8
* DDC_U firmware version (v125 or later)
 v125
* DDC_V firmware version (v124 or later)
 v124
* mcast delay 0-99 centiseconds
  57
* setcl board
  1</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dbbad_ctl">2.6.3. dbbad.ctl</h4>
<div class="paragraph">
<p>The <em>dbbad.ctl</em> file was expanded for use with DBBC3s. For the DBBC3 it can now
include the multicast address, port, and the interface being used. If the last
three parameters are omitted, receiving multi-cast data is disabled. If there
are only comments in the file or the file is empty, use of a DBBC3 at all will
be disabled. An example of the contents are:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>*dbbad.ctl example file
* one uncommented line with up to six fields:
*    host(IP address or name)
*    port(4000)
*    time-out(centiseconds)
*    multicast address
*    multicast port
*    multicast interface
* If there are no uncommented lines, DBBC(2)/DBBC3 access is disabled.
* For DBBC(2), the first three fields are required and no more can be used.
* For DBBC3, there must be either the first three fields or all six. If the
*    final three are missing, multicast reception is disabled.
* Using an IP address instead of a name avoids name server problems.
* DBBC2 example:
*  192.168.1.2 4000 500
* DBBC3 example:
*  192.168.1.2 4000 800 224.0.0.19 25000 eno2</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tsys_monitor_display">2.7. Tsys monitor display</h3>
<div class="paragraph">
<p>Support for the Tsys monitor display is built on multicast capture and
unpacking software developed by Dave Horsley (Hobart).</p>
</div>
<div class="paragraph">
<p>The Tsys monitor display is organized per IF. The displayed information
includes: LO, time, VDIF epoch, time difference between DBBC3 and the FS,
PPS delay, Tsys for each IF/Core3H board as well as BBC information: frequencies
and Tsys values. By default the display will cycle through the appropriate IFs
(dwelling two seconds on each IF) depending on the mode as described in the
<a href="#_modes">Modes</a> sub-section below.</p>
</div>
<div class="paragraph">
<p>The displayed values are from the previous second&#8217;s multicast. Hence the time
is one second in the past and the Tsys values are from two seconds in the past.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The time is shown on inverse video if it is not advancing or disagrees
with the FS when it was received or the firmware is <em>v124</em> (no time is
available in the multicast for that version, so the multicast arrival time is
shown). The epoch is <code>--</code> for now since the VDIF epoch is not available yet in
the multicast.  The <code>DDBC3-FS</code> time difference, in seconds, is shown in inverse
video if it is not zero (positive if the DBBC3 time is later than the FS). The
<code>DDBC3-FS</code> time difference is <code>------</code> for firmware <em>v124</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The display is designed to provide what should normally be the most useful
information without operator intervention. However, the operator can adjust the
display using the features described in <a href="#_commands">Commands</a> sub-section below for
special purposes.</p>
</div>
<table id="geometry" class="tableblock frame-all grid-all" style="width: 50%;">
<caption class="title">Table 1. Tsys monitor display geometry values</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">BBCs/IF</th>
<th class="tableblock halign-center valign-top">width-by-height</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>24x13</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>24x17</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>24x21</code></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_modes">2.7.1. Modes</h4>
<div class="paragraph">
<p>There are three modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Rec</code> shows IFs with channels configured for recording</p>
<div class="paragraph">
<p>This is intended for normal station operations.</p>
</div>
</li>
<li>
<p><code>Def</code> shows IFs with defined LO values</p>
<div class="paragraph">
<p>This may be useful for pointing or calibration runs.</p>
</div>
</li>
<li>
<p><code>All</code> shows all IFs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, if any channels are configured for recorded (selected by the bit
masks in the <code>Core3H</code> commands), the display will go into the <code>Rec</code> mode. If
there are no channels being recorded, but there are LOs defined for some IFs,
it will go into the <code>Def</code> mode. If neither the <code>Rec</code> nor <code>Def</code> mode is
triggered, it will go into the <code>All</code> mode and automatically change to one of
other modes as appropriate. It is also possible to change to the <code>All</code> mode
from <code>Rec</code> or <code>Dec</code> with a single character (<code><strong>l</strong></code>) command. Another <code><strong>l</strong></code> will
toggle the display back to the other mode. The current mode is displayed in the
upper right hand corner.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tsys_values">2.7.2. Tsys values</h4>
<div class="paragraph">
<p>In the <code>Rec</code> mode, only Tsys fields for side-bands being recorded are
populated. Tsys fields for side-bands not being recorded are blank.</p>
</div>
<div class="paragraph">
<p>In the <code>All</code> mode, if no IFs are defined and no channels are being recorded
(e.g., at FS startup), Tsys fields for all side-bands are blank.</p>
</div>
<div class="paragraph">
<p>For all non-blank fields, Tsys values for all BBC side-bands will be shown if
they can be calculated. If they can&#8217;t be, a hint, in inverse video, for the
cause of the problem will be displayed in the corresponding field instead.
There may be more than issue, but only the first encountered is reported. The
order is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>Nccal</code>&#8201;&#8212;&#8201;continuous cal not enabled</p>
</li>
<li>
<p><code>N bbc</code>&#8201;&#8212;&#8201;the BBC is not configured</p>
</li>
<li>
<p><code>N lo </code>&#8201;&#8212;&#8201;the LO is not defined</p>
</li>
<li>
<p><code>Ntcal</code>&#8201;&#8212;&#8201;no Tcal value was found</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
As usual in the FS, an invalid value will be display as dollar signs:
<code>$</code>. That usually means that a value could be calculated, but there was a
problem with the result: the result was too large for the field, was negative
when only positive values are valid, or would have required dividing by zero.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_commands">2.7.3. Commands</h4>
<div class="paragraph">
<p>The Tsys display accepts several one character commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><strong>a</strong></code>-<code><strong>h</strong></code>&#8201;&#8212;&#8201;show only that IF</p>
</li>
<li>
<p><code><strong>n</strong></code>&#8201;&#8212;&#8201;next IF</p>
</li>
<li>
<p><code><strong>p</strong></code>&#8201;&#8212;&#8201;previous IF</p>
</li>
<li>
<p><code><strong>1</strong></code>-<code><strong>9</strong></code>&#8201;&#8212;&#8201;seconds of display time for each IF</p>
</li>
<li>
<p><code><strong>i</strong></code>&#8201;&#8212;&#8201;toggle display of IF or RF frequency for BBCs</p>
</li>
<li>
<p><code><strong>l</strong></code>&#8201;&#8212;&#8201;toggle between <code>All</code> and <code>Rec</code><strong>/</strong><code>Def</code> modes (unfortunately it couldn&#8217;t be <code><strong>a</strong></code>)</p>
</li>
<li>
<p><code><strong>0</strong></code>&#8201;&#8212;&#8201;reset to all defaults</p>
</li>
<li>
<p><code><strong>?</strong></code> or <code><strong>/</strong></code>&#8201;&#8212;&#8201;show help summary</p>
</li>
<li>
<p><kbd>esc</kbd> or <span class="keyseq"><kbd>control</kbd>+<kbd>c</kbd></span>&#8201;&#8212;&#8201;exit</p>
</li>
<li>
<p>Any other key&#8201;&#8212;&#8201;resume cycling</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_checking_dbbc3_time">2.8. Checking DBBC3 time</h3>
<div class="paragraph">
<p>For DBBC3 firmware versions <em>v125</em> and later, the <code>mcast_time</code> command should
be placed in the local <code>midob</code> procedure to monitor the time in the DBBC3 for
each scan. It will report an error if any Core3H boards' time differs from the
FS time or if the multicast data is more than 20 seconds old.</p>
</div>
<div class="paragraph">
<p>For earlier firmware versions, the <code>dbbc3=time</code> command can be used. However,
the output can be difficult to interpret because the boards may sampled in
different seconds.</p>
</div>
<div class="paragraph">
<p>For future firmware versions, after <em>v125</em>, that report the VDIF epoch in the
multicast, it will report if there is a VDIF epoch mismatch between the boards.
Other checks may also be added in the future.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_fs_time">2.9. Setting FS time</h3>
<div class="paragraph">
<p>It is expected that normally the FS computer is running on NTP and the FS time
model is set to <code>computer</code> (see <em>misc/ntp.txt</em> for more information). If good
NTP servers are available, it is expected that will give the best time in the
FS.</p>
</div>
<div class="paragraph">
<p>No suitable NTP servers may be available either because network connectivity is
poor and/or there are no local functioning NTP servers. In that case the FS
program <em>setcl</em> can be used with DBBC3 firmware versions <em>v125</em> and later to
set and adjust FS time (see <em>misc/fstime.txt</em> for the details).</p>
</div>
<div class="paragraph">
<p>The implementation of <em>setcl</em> for the DBBC3 depends on two values from the
<em>dbbc3.ctl</em> control file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The delay of the multicast</p>
<div class="paragraph">
<p>The amount of time that the multicast arrives after the 1 PPS seems to be
stable. This is useful for setting the FS time if NTP is not available. In
tests so far, for the <em>DDC_U</em> <em>v125</em> firmware, it is about 57 centiseconds;
<em>DDC_V</em> <em>v124</em>, about 30 centiseconds. However, since there is no time
available in the <em>v124</em> multicast, it is not useful for setting the FS time.
The value in <em>dbbc3.ctl</em> can be adjusted as appropriate. It should be easy to
measure it for a given firmware when NTP <em>is</em> available using the output of the
<code>mcast_time</code> command.</p>
</div>
</li>
<li>
<p>The board number to use for measuring the time.</p>
<div class="paragraph">
<p>There can be up to eight to choose from. Board <code>1</code> will be in all systems and
should be adequate for the purpose, but which board is used can be changed in
the control file if need be.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>In any event, using <em>setcl</em> to set the FS time this way will only be useful to
level of stability of the delay of the multicast. Network congestion may also
cause variations, but hopefully will be minimal in situations where this method
is needed.</p>
</div>
<div class="paragraph">
<p>Even if there are significant variations, even a significant fraction of a
second (which seems unlikely), in the arrival of the multicast, the clock model
determined should be useful.  Individual offset measurements should be fairly
accurate. If the clock model is determined over a significant amount of time, a
day or more, the fractional error in the model rate should be small. The use of
<code>adjust</code> option of <em>setcl</em> in each <code>midob</code> should keep the FS close to the
correct time. It should be good enough to run a schedule. In any event, it
should better than any other approach without NTP. Since the DBBC3 will be
running on the correct time, small errors in the FS time should typically not
be significant.</p>
</div>
</div>
<div class="sect2">
<h3 id="_multicast_logging">2.10. Multicast logging</h3>
<div class="paragraph">
<p>Support for multicast logging is built on multicast capture and unpacking
software developed by Dave Horsley (Hobart).</p>
</div>
<div class="paragraph">
<p>Logging of DBBC3 multi-cast recording is controlled by the <code>tpicd</code> command.
When logging is enabled, for each multicast message received (nominal 1 Hz
rate), the following information is logged:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>time</code>&#8201;&#8212;&#8201;for each Core3H board in the system</p>
</li>
<li>
<p><code>pps2dot</code>&#8201;&#8212;&#8201;(<code>pps_delay</code>) in nanoseconds for each Core3H board</p>
</li>
<li>
<p><code>tpcont</code> &#8201;&#8212;&#8201;Only if continuous cal is in use&#8201;&#8212;&#8201;TPI counts for each BBC and IF configured for recording.</p>
<div class="paragraph">
<p>The counts are given in the order of cal <em>on</em> then <em>off</em></p>
</div>
</li>
<li>
<p><code>tpi</code> &#8201;&#8212;&#8201;Only if continuous cal is <em>not</em> in use&#8201;&#8212;&#8201;TPI counts for each BBC and IF configured for recording.</p>
</li>
<li>
<p><code>tsys</code>&#8201;&#8212;&#8201;Only if continuous cal is in use&#8201;&#8212;&#8201;Tsys for each BBC and IF configured for recording.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>plog</em> utility was modified to push reduced logs with DBBC3 multicast data
squeezed out by default, as it already did for RDBEs. Please see <code><strong>plog
-h</strong></code> for more information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Even when not being logged, multicast data is normally being received. A subset
can be seen in the <a href="#_tsys_monitor_display">Tsys monitor display</a>. When the DBBC3 is busy processing
commands, it may suppress multicast messages. The FS will complain once every
20 seconds if it is not receiving multicast. When manually commanding the
DBBC3, e.g., for troubleshooting, these errors can be suppressed by using the
command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>tpicd=stop</pre>
</div>
</div>
<div class="paragraph">
<p>To restart the error reports, <em>tpicd</em> should be configured and started. Any
<em>drudg</em> generated <code>setup</code> procedure will do this.</p>
</div>
<div class="paragraph">
<p>When <em>drudg</em> generated <code>setup</code> procedures are executing they will suppress
these errors because they use <code>tpcid=stop</code> when they start. As a <code>setup</code>
procedure finishes, it will restart <em>tpicd</em>.</p>
</div>
<div class="paragraph">
<p>This method can also be used to suppress multicast errors for equipment
monitoring in the <code>midob</code> procedure. That is, group all the commands that cause
multicast errors together and place them after a <code>tpcid=stop</code> and follow them
with a <code>tpcid</code>. This should not cause a significant, if any, additional loss of
logged multicast data. The losses may be unacceptable in any event,
particularly for very short scans. In that case, the commands that cause these
errors should probably not be included <code>midob</code> at all. The <code>mcast_time</code> command
can be used to monitor the DBBC3 time without generating any of these errors.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_related_features">3. Related Features</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_minimizing_the_use_of_setup_procedures">3.1. Minimizing the use of setup procedures</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This also applies to any system using a Mark 5C or FlexBuff recorder.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Normally, the FS sets the mode for each scan (unless there is continuous
recording). If this takes too long or makes the equipment unstable, the <em>drudg</em>
option <code>use_setup_proc yes</code> in <em>skedf.ctl</em> can be used to minimize the
execution of the setup procedure.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Not executing the setup each scan may not be robust if the equipment
sometimes loses it configuration. It is up to the individual stations to
determine whether minimizing its use is better than always using it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With this enabled, <em>drudg</em> will replace the calls to setup procedures (e.g.,
<code>setup01</code>) in the <em>.snp</em> file with, e.g.:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>setup_proc=setup01</pre>
</div>
</div>
<div class="paragraph">
<p>When the FS encounters this command, it will conditionally execute the setup
procedure if either of the following is true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This is first setup since the schedule was last started.</p>
<div class="paragraph">
<p>This will make sure the setup is run at the start and any restart of the
schedule.</p>
</div>
</li>
<li>
<p>If there was a mode change, i.e., the name of the setup procedure changed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>use_setup_proc</code> option in <em>skedf.ctl</em> has three possible settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>yes</code>&#8201;&#8212;&#8201;use the <code>setup_proc</code> command</p>
</li>
<li>
<p><code>no</code> &#8201;&#8212;&#8201;do not use the <code>setup_proc</code> command</p>
</li>
<li>
<p><code>ask</code>&#8201;&#8212;&#8201;to prompt for <code>yes</code> or <code>no</code> for each schedule</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the option is not used, it defaults to <code>no</code>.</p>
</div>
<div class="paragraph">
<p>The <em>fesh</em> program was expanded to support an environment variable,
<code>FESH_GEO_USE_SETUP_PROC</code>, and a command line option, <code>-u</code>, to set the answer
for an interactive prompt for the whether or not to use <code>setup_proc</code> when
<em>drudg</em>ing geodesy schedules. Please see <code><strong>fesh -h</strong></code> for more
information.</p>
</div>
<div class="paragraph">
<p>Thanks to Jon Quick (HartRAO) and Harro Verkouter (JIVE) for suggesting this
option. They also suggested that it may be utilized as part of future features
for additional checking and resetting of the system.</p>
</div>
</div>
<div class="sect2">
<h3 id="_thread_procedure">3.2. Thread procedure</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This also applies to any system using a Mark 5C or FlexBuff recorder.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a Mark 5C or FlexBuff recorder is in use, <em>drudg</em> can optionally insert a
<code>thread<em>suffix</em></code> procedure in each setup procedure (where <code><em>suffix</em></code> is a
mode specific suffix). This can be used to control whether the recordings for an
experiment is multi-threaded or single thread per file.</p>
</div>
<div class="paragraph">
<p>The contents of the procedure is same for every mode in the schedule. This
feature is controlled by the <code>vdif_single_thread_per_file</code> option in
<em>skedf.ctl</em> control file. The option only needs to be used by stations that
need to always use a single thread per file or switch between experiments. If
the option is not present, no <code>thread<em>suffix</em></code> procedure is inserted.  If
it is present, the possible setting are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>yes</code>&#8201;&#8212;&#8201;to store a single thread per file, in which case, the
<code>thread<em>suffix</em></code> procedure contents are:</p>
<div class="literalblock">
<div class="content">
<pre>jive5ab=datastream=clear
jive5ab=datastream=add:{thread}:*
jive5ab=datastream=reset</pre>
</div>
</div>
</li>
<li>
<p><code>no</code>&#8201;&#8212;&#8201;for normal multi-threaded recordings, in which case, the
<code>thread<em>suffix</em></code> procedure contents are:</p>
<div class="literalblock">
<div class="content">
<pre>jive5ab=datastream=clear
jive5ab=datastream=reset</pre>
</div>
</div>
</li>
<li>
<p><code>ask</code>&#8201;&#8212;&#8201;to be prompted once per schedule for what to do</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>fesh</em> program was expanded to support an environment variable,
<code>FESH_GEO_VDIF_SINGLE_THREAD_PER_FILE</code>, and a command line option, <code>-T</code>, to set
the answer for an interactive prompt for the whether or not to use a single
thread per file when <em>drudg</em>ing geodesy schedules. Please see <code><strong>fesh -h</strong></code>
for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_jive5ab_cnfg_procedure">3.3. jive5ab_cnfg procedure</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This also applies to any system using a Mark 5C or FlexBuff recorder.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each mode SNAP procedure produced by <em>drudg</em> for Mark 5C and FlexBuff recorders
includes a call to the <code>jive5ab_cnfg</code> SNAP procedure. This procedure call is
inserted immediately after the <code>mk5c_mode</code>/<code>fb_mode</code> command (and after the
optional <a href="#_thread_procedure">Thread procedure</a> call if present). The procedure is mode
independent, i.e., the same procedure is used for all modes.</p>
</div>
<div class="paragraph">
<p>This procedure is a local <code>station</code> library procedure to allow tuning of the
configuration of <em>jive5ab</em> for the specifics of the recorder, including
overriding the &#8220;default&#8221; configuration given by the <code>mk5c_mode</code>/<code>fb_mode</code>
command and a <code>thread<em>suffix</em></code> procedure.</p>
</div>
<div class="sect3">
<h4 id="_default_configuration">3.3.1. Default configuration</h4>
<div class="paragraph">
<p>The <code>mk5c_mode</code>/<code>fb_mode</code> command sends the configuration commands, beyond
<code><em>mode</em></code>,  depending on which recorder is selected in <em>equip.ctl</em>, <code>mk5c</code> or
<code>flexbuff</code>, and the total data rate. It does <em>not</em> depend on which command is
used; <code>fb_mode</code> is just an alias for <code>mk5c_mode</code>. The commands sent also depend
on the data type, VDIF or 5B/Ethernet. All the cases are listed below.</p>
</div>
<div class="sect4">
<h5 id="_flexbuff_recorder">FlexBuff recorder</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Setting <code>mtu</code>:</p>
<div class="paragraph">
<p>The <code>mtu</code> command sent to the recorder depends on the data type:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>VDIF data</p>
<div class="literalblock">
<div class="content">
<pre>mtu = 9000 ;</pre>
</div>
</div>
</li>
<li>
<p>5B/Ethernet data</p>
<div class="literalblock">
<div class="content">
<pre>mtu = 6000 ;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Setting <code>net_protocol</code>:</p>
<div class="paragraph">
<p>There is a variable field <code><em>socketbuffer</em></code> in the <code>net_protocol</code> command sent
to the recorder. Its value is independent of the data type.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>net_protocol = udpsnor : _socketbuffer_ : 256000000 : 4 ;</pre>
</div>
</div>
<div class="paragraph">
<p>Where the <em>socketbuffer</em> field depends on the total data rate:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>32000000&#8201;&#8212;&#8201;data rate &lt; 1 Gbps</p>
</li>
<li>
<p>64000000&#8201;&#8212;&#8201;1 Gbps &lt; data rate &#8656; 4 Gbps</p>
</li>
<li>
<p>128000000&#8201;&#8212;&#8201;data rate &gt; 4 Gbps</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>socketbuffer</em> parameter is an important setting for trying to minimize
risk of packet loss when starting the recording. For (very) high data rates,
the <code>jive5ab_cnfg</code> procedure can be used to increase the <em>socketbuffer</em> size to
values appropriate for that. This assumes that the FlexBuff has been tuned
(especially the kernel network buffer sizes) along the lines of the FlexBuff
tuning documentation at
<a href="https://www.jive.eu/~verkout/flexbuff/flexbuf.recording.txt" class="bare">https://www.jive.eu/~verkout/flexbuff/flexbuf.recording.txt</a>.</p>
</div>
</li>
<li>
<p>Setting <code>record = nthread</code>:</p>
<div class="paragraph">
<p>There is a variable field <code><em>nWriters</em></code> in the <code>record = nthread</code> command sent
to the recorder. Its value is independent of the data type.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>record = nthread : <em>nWriters</em> ;</pre>
</div>
</div>
<div class="paragraph">
<p>where <code><em>nWriters</em></code> is calculated as <code>max( <em>data_rate</em> / 6 + 1, 2)</code> and
<code><em>data_rate</em></code> is the total data rate in Gbps.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_mark_5c_recorder">Mark 5C recorder</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Setting <code>net_protocol</code>:</p>
<div class="paragraph">
<p>The <code>net_protocol</code> command sent to the recorder is independent of the data
type:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>net_protocol = : 128k : 2M : 4;</pre>
</div>
</div>
</li>
<li>
<p>Setting <code>packet</code>:</p>
<div class="paragraph">
<p>The <code>packet</code> command sent to the recorder depends on the data type:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>VDIF data</p>
<div class="literalblock">
<div class="content">
<pre>packet = 36 : 0 : 8032 : 0 : 0 ;</pre>
</div>
</div>
</li>
<li>
<p>5B/Ethernet data</p>
<div class="literalblock">
<div class="content">
<pre>packet = 36 : 0 : 5008 : 0 : 0 ;</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_overriding_the_defaults">3.3.2. Overriding the defaults</h4>
<div class="paragraph">
<p>You can override the commands sent by the <code>mk5c_mode</code>/<code>fb_mode</code> command or add
more by putting them in your local <code>jive5ab_cnfg</code>. This works because
<code>jive5ab_cnfg</code> is called after <code>mk5c_mode</code>/<code>fb_mode</code> command (<em>and</em> after the
call to the optional <a href="#_thread_procedure">Thread procedure</a>) in the setup procedure. An example
of local customizations is given in the sub-sections below.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
If you put any commands in <code>jive5ab_cnfg</code> that depend on the data
type, VDIF or 5B/Ethernet, you would need to change them if there is a change
in the data type. This is not a concern for most stations.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_changing_net_protocol">Changing net_protocol</h5>
<div class="paragraph">
<p>If you use different values for <code>net_protocol</code>, you can leave any field blank
that your don&#8217;t need to change from what the FS has already sent. For example
to only set the <em>socketbuffer</em> size to <code>64000000</code>, use:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>net_protocol = : 64000000</pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Questions:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="9">
<li>
<p>Is the description correct for the above?</p>
<div class="paragraph">
<p>Harro: Yes</p>
</div>
</li>
<li>
<p>Should we add guidelines for tuning parameters depending on the recorder?</p>
<div class="paragraph">
<p>Harro: I&#8217;ve put in a link to the FlexBuff tuning document</p>
</div>
</li>
<li>
<p>Are there other examples we should give?</p>
</li>
<li>
<p>Should <code>net_protocol</code> for Mark 5C have a value?</p>
<div class="paragraph">
<p>Harro: No, Mark5C recording ignores the <code>net_protocol</code> (the current command is
just to clear out any possible stale settings) - all is configured through
<code>packet=&#8230;&#8203;</code></p>
</div>
</li>
<li>
<p>I know we decided to put this single file per thread option in
<code>jive5ab_cnfg</code>, but I can&#8217;t remember now if we thought it was because it would
not be changed very often or if I was reluctant to ask for a <em>drudg</em> option. I
am now thinking we might be able to add it as an option. A question is whether
it is worthwhile. I don&#8217;t know how many stations would use it. I guess Eskil
would, but if so, is it better than commenting/un-commenting the relevant line
in <code>jive5ab_cnfg</code>?</p>
<div class="paragraph">
<p>Harro: Actually - having it as a <em>drudg</em> option wouldn&#8217;t be too bad! I think
there is wider interest in this feature. And it would make it more predictable
and convenient: stations can change as per experiment&#8217;s request.</p>
</div>
<div class="paragraph">
<p>Ed: If we made it an option, it might be controlled by a <em>skedf.ctl</em> option
<code>vdif_single_thread_per_file</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the option is not present <em>drudg</em> does nothing.</p>
</li>
<li>
<p>If the option is set to <code>yes</code>, <em>drudg</em> produces a <code>thread</code> procedure with the
commands above.</p>
</li>
<li>
<p>If the option is set to <code>no</code>,  <em>drudg</em> produces a <code>thread</code> procedure without
the <code>jive5ab=datastream=add:{thread}:*</code> command.</p>
</li>
<li>
<p>If the option is set to <code>ask</code>, it will prompt for <code>yes</code> or <code>no</code> for each
experiment.</p>
<div class="paragraph">
<p>Maybe we could have <code>skip</code> option (do nothing) for <code>ask</code> as well if it would be
helpful.</p>
</div>
</li>
<li>
<p>The <code>thread</code> procedure would come after <code>mk5c_mode</code>/<code>fb_mode</code> and before
<code>jive5ab_cnfg</code>.</p>
<div class="paragraph">
<p>Harro: Yup, that would allow stations to still override things the FS and
<em>drudg</em> have done so far</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_drudg_support">3.4. drudg support</h3>
<div class="paragraph">
<p><em>drudg</em> supports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Up to 128 dual side-band BBCs and eight IFs for VEX (<em>.vex</em>) schedule files.</p>
</li>
<li>
<p>Up to 16 dual side-band BBCs (<code>1</code>-<code>16</code>) and two IFs (<code>a</code> and <code>b</code>) for Mark IV
(<em>.skd</em>) schedule files.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For a schedule that would nominally have a number of channels on an IF
that is less than a power of two (for example, an <em>S/X</em> mode), the channels for
such an IF will need to be rounded up the next power of two. For example for
<em>S</em>/<em>X</em>, the IF (<em>X</em>) with eight USB and two LSB channels will need to be
expanded to eight USB and eight LSB; the IF (<em>S</em>) with six USB channels, to
eight USB. These settings can be in the schedule file and flow from the
catalog, so it is all automatic for the scheduler and the station.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The appropriate new <a href="#_dbbc3_commands">DBBC3 commands</a> are used in setup procedures.</p>
</li>
<li>
<p>The new <em>skedf.ctl</em> options for <a href="#_minimizing_the_use_of_setup_procedures">Minimizing the use of setup procedures</a>
and the <a href="#_thread_procedure">Thread procedure</a>.</p>
</li>
<li>
<p>The following previously DBBC2 specific <em>skedf.ctl</em> options can also be used
for DBBC3s:</p>
<div class="ulist">
<ul>
<li>
<p><code>cont_cal</code></p>
</li>
<li>
<p><code>cont_cal_polarity</code></p>
</li>
<li>
<p><code>dbbc_if_targets</code></p>
</li>
<li>
<p><code>dbbc_bbc_target</code></p>
</li>
<li>
<p><code>default_dbbc_if_inputs</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_other_vdif_frame_payload_sizes">Appendix A: Handling other VDIF frame payload sizes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The value of <code>8000</code> for the VDIF frame payload size is hard coded in the FS for
the DBBC3 and <em>jive5ab</em> (and DBBC2/FiL10G as well). Currently this is the
correct value, but some day in the future, different values may be needed. If
that occurs before the FS is updated to accommodate other values, this section
gives a recipe for handling it for the DBBC3 and <em>jive5ab</em> in the meantime.  It
is a little complicated, but should work. Hopefully, the FS will be updated
before it is necessary.</p>
</div>
<div class="paragraph">
<p>The basic strategy is to <a href="#_determine_the_other_settings">Determine the other settings</a> needed in the DBBC3
and <em>jive5ab</em> <code>vdif_frame</code> commands, <a href="#_update_the_snap_procedures">Update the SNAP procedures</a> to contain
them, and then <a href="#_command_the_devices">Command the devices</a> with the new values. These are all
described in the following sub-sections.</p>
</div>
<div class="paragraph">
<p>After commanding a different VDIF payload size, the FS will complain that the
DBBC3 <code>vdif_frame</code> payload is not correct when you check the DBBC3
configuration (i.e., using the <code>setup<em>mode</em></code> procedure without the <code>force</code>
parameter), but if that is the only complaint, there should not be a problem.</p>
</div>
<div class="paragraph">
<p>These sub-sections extend the example in the <a href="#_configuring_core3h_boards">Configuring Core3H boards</a>
sub-section above.</p>
</div>
<div class="sect2">
<h3 id="_determine_the_other_settings">A.1. Determine the other settings</h3>
<div class="paragraph">
<p>The settings can be calculated from first principles. However, another way to
determine them is to use the <code>echo</code> output from the FS for what would otherwise
be the correct setup:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>proc=r4849kk
echo=on
setup01=force
echo=off</pre>
</div>
</div>
<div class="paragraph">
<p>You will need to identify the <code>#dbbcn#core3h=<em>n</em>,vdif_frame &#8230;&#8203;</code> and
<code>#mk5cn#VDIF_8000-&#8230;&#8203;</code> records in the output and use the values recorded in the
next sub-section.</p>
</div>
</div>
<div class="sect2">
<h3 id="_update_the_snap_procedures">A.2. Update the SNAP procedures</h3>
<div class="paragraph">
<p>These examples use <code>8200</code> as an example different payload size.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
The examples below do not necessarily contain correct values. They are
just offered to show the form of the commands.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You will need to create a new SNAP procedure, perhaps called <code>vdif_8200</code>,
that contains all the other values in the <code>core3h=<em>n</em>,vdif_frame &#8230;&#8203;</code> commands
recorded in the previous section, but with the new payload size, for example:</p>
<div class="literalblock">
<div class="content">
<pre>dbbc3=core3h=1,vdif_frame 2 8 8200 ct=off
dbbc3=core3h=2,vdif_frame 2 8 8200 ct=off
dbbc3=core3h=3,vdif_frame 2 8 8200 ct=off
dbbc3=core3h=4,vdif_frame 2 8 8200 ct=off
dbbc3=core3h=5,vdif_frame 2 8 8200 ct=off
dbbc3=core3h=6,vdif_frame 2 8 8200 ct=off
dbbc3=core3h=7,vdif_frame 2 8 8200 ct=off
dbbc3=core3h=8,vdif_frame 2 8 8200 ct=off</pre>
</div>
</div>
</li>
<li>
<p>You can add a new <code>VDIF_&#8230;&#8203;</code> command with the other recorded values, but with
the new payload size, to the <code>setup<em>mode</em></code>  procedure (<code>setup01</code> in this
example) <em>after</em> the call to <code>jive5ab_cnfg</code>. For example, add the command:</p>
<div class="literalblock">
<div class="content">
<pre>jive5ab=VDIF_8200-8192-2-8</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Not putting this command directly into your <code>jive5ab_cnfg</code> procedure
allows it to be mode specific. If you want to apply this change universally,
you can put it into your <code>jive5ab_cnfg</code> procedure instead, but be wary of other
modes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_command_the_devices">A.3. Command the devices</h3>
<div class="paragraph">
<p>Continuing the example, enter:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>proc=r4849kk
setup01=force
vdif_8200</pre>
</div>
</div>
<div class="paragraph">
<p>Afterwards, you will need to sync the time as described in the <a href="#_time_sync">Time sync</a>
sub-section above and start the data transmission as described in the
<a href="#_starting_data_transmission">Starting data transmission</a> sub-section above.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The reason the setting of the VDIF payload size is done <em>outside</em> of the
<code>setup<em>mode</em></code> procedure is so that when that procedure is used to <em>check</em> the
DBBC3 configuration, the <code>dbbc3=core3h=<em>n</em>,vdif_frame &#8230;&#8203;</code> commands won&#8217;t cause
a requirement to re-sync the DBBC3.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_for_testing">Appendix B: Installation for testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section has some terse installation notes for installing the FS branch,
<code>ed/dbbc3</code>, that provides the features described in this document. This is
provided only to help with testing. This is not for an operational release.</p>
</div>
<div class="paragraph">
<p>Sub-sections on <a href="#_switching_back_to_10_0_0">Switching back to 10.0.0</a> and <a href="#Switching back to the test
version">[Switching back to the test
version]</a> as also provided in case you need to switch back and forth after
using the <a href="#_initial_installation_of_the_test_version">Initial installation of the test version</a> sub-section.</p>
</div>
<div class="sect2">
<h3 id="_initial_installation_of_the_test_version">B.1. Initial installation of the test version</h3>
<div class="paragraph">
<p>You must have FS 10.0.0 installed before installing the test version. Please
see <a href="https://nvi-inc.github.io/fs/releases/10/0/10.0.0.html" class="bare">https://nvi-inc.github.io/fs/releases/10/0/10.0.0.html</a> for instructions for
installing FS 10.0.0.</p>
</div>
<div class="sect3">
<h4 id="_fetch_and_make_the_latest_commit_on_the_branch">B.1.1. Fetch and make the latest commit on the branch</h4>
<div class="paragraph">
<p>If you are using <em>git</em>, as is recommended, then as <em>prog</em>
execute:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd /usr2/fs-git
git fetch
git checkout ed/dbbc3
make clean rmdoto rmexe
make &gt;&amp; /dev/null
make -s</pre>
</div>
</div>
<div class="paragraph">
<p>No output from the last command indicates a successful <em>make</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It should not be necessary to re<em>make</em> your station software.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_reboot">B.1.2. Reboot</h4>
<div class="paragraph">
<p>This will make sure the FS server is restarted and shared memory is
reinitialized.</p>
</div>
</div>
<div class="sect3">
<h4 id="_additional_steps">B.1.3. Additional steps</h4>
<div class="paragraph">
<p>Except as noted, these steps should all be performed as <em>oper</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <em>dbbc3.ctl</em> control file.</p>
<div class="paragraph">
<p>The contents of DBBC3 line in the <em>equip.ctl</em> control file has been moved to
the new control file, <em>dbbc3.ctl</em>, and reorganized. To install the new file,
execute:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd /usr2/control
cp /usr2/fs/st.default/control/dbbc3.ctl .</pre>
</div>
</div>
<div class="paragraph">
<p>Edit and customize the contents of your local copy in <em>/usr2/control</em> to agree
with your DBBC3.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For now, your old DBBC3 line in <em>equip.ctl</em> can be left in place. Its
presence will be benign and leaving it there will make it easier to return your
operational FS version when that is needed. The values in the <em>dbbc3.ctl</em>
control file are the ones actually used by this test branch of the FS.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Update <em>equip.ctl</em></p>
<div class="paragraph">
<p>Change your rack type to <code>dbbc3_ddc_u</code> or <code>dbbc3_ddc_v</code> as appropriate.</p>
</div>
</li>
<li>
<p>Add <code>jive5ab_cnfg</code> procedure to your <code>station</code> procedure library.</p>
<div class="paragraph">
<p>Using <em>pfmed</em>, add a <code>jive5ab_cnfg</code> procedure to your <code>station</code> procedure
library. It can be empty if no tuning is needed for your recorder.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This procedure is called by setup procedures for Mark 5C and FlexBuff
recorders and provides a means to tune the setup of <em>jive5ab</em> for your hardware
independent of the observing mode. This procedure is called after the
<code>mk5c_mode</code>/<code>fb_mode</code> commands to allow the default configuration to be
overridden. The default configuration is described in the
<a href="#_default_configuration">Default configuration</a> subsection in main part of this document.
The commands in this procedure should be mode independent. Mode dependent
tuning should be handled differently; perhaps by inserting commands directly
at the top-level of the setup procedure.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Setup the DBBC3 Tsys display window (<em>monit7</em>)</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Update <em>clpgm.ctl</em></p>
<div class="paragraph">
<p>Compare your local copy to the example</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd /usr2/control
diff clpgm.ctl /usr2/fs/st.default/control/ | less</pre>
</div>
</div>
<div class="paragraph">
<p>and consider whether and what changes you should make. Typically, the new line
for <em>monit7</em> would be added to your local copy.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you are familiar with <em>vimdiff</em>, you may find it a more convenient way
to compare files and update your local copy. Like <em>vim</em>, <em>vimdiff</em> may be
challenging to use until you are familiar with it. Some help is available from
web searches. Don&#8217;t use it if you aren&#8217;t comfortable with it.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Update <em>stpgm.ctl</em></p>
<div class="paragraph">
<p>If you are using the display server and you want to have <em>monit7</em> start
automatically with each client (including at FS start up), add a line for it to
<em>stpgm.ctl</em>. The easiest way to do this is to make a copy of the line for
<em>monit2</em> and update for <em>monit7</em> (changing <code>2</code>s to <code>7</code>s). If you don&#8217;t have
a line for <em>monit2</em> in your <em>stpgm.ctl</em>, you can use the one in the example
file, <em>/usr2/fs/st.default/control/stpgm.ctl</em>, as a guide.</p>
</div>
</li>
<li>
<p>Update your local rc files:</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Update <em>~/.Xresources</em></p>
<div class="paragraph">
<p>Append the new lines from the default version:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd ~
tail -n 2 /usr2/fs/st.default/oper/.Xresources &gt;&gt;.Xresources</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The default geometry resource in <em>/usr2/fs/st.default/oper/.Xresources</em>
for <em>monit7</em> handles having up to 16 BBCs per IF.  If you have fewer, you might
want to adjust the resource in your local file according to the <a href="#geometry">Tsys
monitor display geometry values</a> table above.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If you use the default window manager for the console, update <em>~/.fvwm2rc</em>:</p>
<div class="paragraph">
<p>Compare your local file to the default</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd ~
diff .Xresources /usr2/fs/st.default/oper |less</pre>
</div>
</div>
<div class="paragraph">
<p>The new lines for <em>monit7</em> should be added to your local file.</p>
</div>
</li>
<li>
<p>You should  make the corresponding changes for <em>prog</em> while logged
in as <em>prog</em>.</p>
</li>
<li>
<p>Log out and back in to put these changes into effect.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_switching_back_to_10_0_0">B.2. Switching back to 10.0.0</h3>
<div class="paragraph">
<p>Once you have the <code>ed/dbbc3</code> your can return to using <em>10.0.0</em> by following
these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>As <em>prog</em>, enter:</p>
<div class="literalblock">
<div class="content">
<pre>cd /usr2/fs-git
git checkout -q 10.0.0
make clean rmdoto rmexe
make &gt;&amp; /dev/null
make -s</pre>
</div>
</div>
</li>
<li>
<p>Reboot</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you added <em>monit7</em> to your <em>stpgm.ctl</em> file, you can comment it out
(as <em>oper</em>), but that is not necessary.  The only consequence of not doing so
will be a &#8220;flash&#8221; when the display client starts as an <em>xterm</em> and then it
closes because it can&#8217;t start <em>monit7</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_switching_back_to_the_test_version">B.3. Switching back to the test version</h3>
<div class="paragraph">
<p>If you have switched back to <em>10.0.0</em> and now want to switch back to the test
version, please follow these steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>As <em>prog</em>, enter:</p>
<div class="literalblock">
<div class="content">
<pre>cd /usr2/fs-git
git checkout ed/dbbc3
make clean rmdoto rmexe
make &gt;&amp; /dev/null
make -s</pre>
</div>
</div>
</li>
<li>
<p>Reboot</p>
</li>
<li>
<p>If as part of switching back to <em>10.0.0</em>, you had commented out the <em>monit7</em>
line in your <em>stpgm.ctl</em> file, you can uncomment it (as <em>oper</em>).</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-09-23 11:15:44 -0400
</div>
</div>
</body>
</html>